<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Social Network for Music</title>
    <link rel="icon" href="./img/headphones-solid.svg" type="image/x-icon" />
    <!-- Font -->
    <!-- <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" /> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <!-- Icone -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Style.css -->
    <link rel="stylesheet" href="./style/style-home.css" />
  </head>
  <body>
    <!-- ======= Header ======= -->
    <header
      id="header"
      class="header fixed-top d-flex align-items-center justify-content-between"
    >
      <div class="d-flex align-items-center justify-content-between w-50">
        <i class="bi bi-list toggle-sidebar-btn"></i>
        <a href="home.html" class="logo d-flex align-items-center">
          <i class="fa-solid fa-headphones fa-2xl me-3"></i>
          <span class="d-none d-lg-block">SNM</span>
        </a>
      </div>
      <div class="nav-item dropdown pe-3">
        <a
          class="nav-link nav-profile d-flex align-items-center pe-0"
          href="#"
          data-bs-toggle="dropdown"
        >
          <img
            src="./img/profile.png"
            alt="profile"
            style="width: 25px; height: 25px; border-radius: 50%"
          />
          <span
            class="d-none d-md-block dropdown-toggle ps-2"
            id="usernameHeader"
            >Username</span
          >
        </a>

        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
          <li class="dropdown-header" id="nominativoHeader">
            <h6>Nome Cognome</h6>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>

          <li>
            <a class="dropdown-item d-flex align-items-center" href="/profile">
              <i class="bi bi-person"></i>
              <span>Il mio profilo</span>
            </a>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center" href="/logout">
              <i class="bi bi-box-arrow-right"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </header>
    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
      <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
          <a class="nav-link collapsed" href="/home">
            <i class="bi bi-grid"></i>
            <span>Homepage</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/profile">
            <i class="bi bi-person"></i>
            <span>Profilo</span>
          </a>
        </li>
        <li class="nav-heading">Scopri</li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/tracks">
            <i class="bi bi-music-note"></i>
            <span>Brani</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/publicPlaylist">
            <i class="bi bi-music-note-list"></i>
            <span>Playlists</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/myPlaylist">
            <i class="bi bi-file-music"></i>
            <span>Le mie playlist</span>
          </a>
        </li>
      </ul>
    </aside>
    <!-- ======= Main ======= -->
    <div class="main" id="main">
      <div
        class="page-name mb-3 d-flex flex-column align-items-center align-items-sm-start"
      >
        <h1 class="mt-4">Le mie playlist</h1>
        <h2 class="text-secondary text-center">
          Qui puoi trovare le tue playlist e le playlist che hai seguito!
        </h2>
      </div>
      <!-- ======= Playlist list ======= -->
      <div class="cards-container mt-5 ms-3 ms-sm-0">
        <div class="playlist-cards mt-4 d-flex flex-wrap" id="playlist-cards">
          <a
            class="card mb-5 me-4 me-sm-5 border-0 shadow rounded-4 p-3 pb-0"
            style="width: 150px; height: 200px; background-color: #fdfdfd"
            href="/createPlaylist"
          >
            <img src="./img/add-new.jpg" class="card-img-top" alt="add" />
            <h5 class="text-center fw-semibold mt-2">
              Crea una nuova playlist!
            </h5>
          </a>
        </div>
      </div>
    </div>
    <script src="./main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <script>
      const playlistCards = document.getElementById('playlist-cards');

      fetch('/api/playlist/get-my-playlists')
        .then((response) => response.json())
        .then((data) => {
          if (data.status === 'ok') {
            const playlists = data.data;
            playlists.forEach((playlist) => {
              const playlistCard = document.createElement('a');
              playlistCard.classList.add(
                'card',
                'mb-4',
                'me-4',
                'border-0',
                'me-sm-5'
              );
              playlistCard.style.width = '150px';
              playlistCard.style.height = '200px';
              playlistCard.style.backgroundColor = '#FDFDFD';
              playlistCard.href = '/playlist/' + playlist._id;

              const img = document.createElement('div');
              img.style.position = 'relative';
              img.style.height = '150px';
              img.style.width = '150px';
              img.classList.add('card-img-top');
              if (playlist.tracce.length === 0) {
                const picture1 = document.createElement('img');
                picture1.classList.add('img-fluid');
                picture1.src = './img/playlist-default.png';
                img.appendChild(picture1);
              } else if (playlist.tracce.length === 1) {
                const picture1 = document.createElement('img');
                picture1.classList.add('img-fluid', 'rounded');
                picture1.src = playlist.tracce[0].immagine;
                img.appendChild(picture1);
              } else if (playlist.tracce.length <= 3) {
                img.classList.add('d-flex', 'justify-content-center');
                const picture1 = document.createElement('img');
                picture1.classList.add('img-fluid', 'rounded-start');
                picture1.style.objectFit = 'cover';
                picture1.style.maxWidth = '50%';
                picture1.src = playlist.tracce[0].immagine;
                img.appendChild(picture1);
                const picture2 = document.createElement('img');
                picture2.classList.add('img-fluid', 'rounded-end');
                picture2.style.objectFit = 'cover';
                picture2.style.maxWidth = '50%';
                picture2.src = playlist.tracce[1].immagine;
                img.appendChild(picture2);
              } else {
                img.classList.add('d-flex', 'justify-content-center');
                const picture1 = document.createElement('img');
                picture1.style.position = 'absolute';
                picture1.style.top = '0';
                picture1.style.left = '0';
                picture1.classList.add('img-fluid', 'w-50', 'rounded-top-left');
                picture1.src = playlist.tracce[0].immagine;
                img.appendChild(picture1);
                const picture2 = document.createElement('img');
                picture2.style.position = 'absolute';
                picture2.style.top = '0';
                picture2.style.right = '0';
                picture2.classList.add(
                  'img-fluid',
                  'w-50',
                  'rounded-top-right'
                );
                picture2.src = playlist.tracce[1].immagine;
                img.appendChild(picture2);
                const picture3 = document.createElement('img');
                picture3.style.position = 'absolute';
                picture3.style.bottom = '0';
                picture3.style.left = '0';
                picture3.classList.add(
                  'img-fluid',
                  'w-50',
                  'rounded-bottom-left'
                );
                picture3.src = playlist.tracce[2].immagine;
                img.appendChild(picture3);
                const picture4 = document.createElement('img');
                picture4.style.position = 'absolute';
                picture4.style.bottom = '0';
                picture4.style.right = '0';
                picture4.classList.add(
                  'img-fluid',
                  'w-50',
                  'rounded-bottom-right'
                );
                picture4.src = playlist.tracce[3].immagine;
                img.appendChild(picture4);
              }
              playlistCard.appendChild(img);

              const cardBody = document.createElement('div');
              const title = document.createElement('h4');
              title.classList.add('card-title', 'text-truncate', 'm-0', 'p-1');
              title.textContent = playlist.titolo;
              const owner = document.createElement('h5');
              owner.classList.add(
                'card-subtitle',
                'text-muted',
                'text-truncate',
                'px-1'
              );
              owner.textContent = 'Di ' + playlist.creatore;
              cardBody.appendChild(title);
              cardBody.appendChild(owner);
              playlistCard.appendChild(cardBody);
              playlistCards.appendChild(playlistCard);
            });
          } else {
            console.error('Errore nel recupero delle playlist:', data.error);
          }
        })
        .catch((error) => {
          console.error('Errore nella richiesta delle playlist:', error);
        });
    </script>
  </body>
</html>
