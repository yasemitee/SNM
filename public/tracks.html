<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Social Network for Music</title>
    <link rel="icon" href="./img/headphones-solid.svg" type="image/x-icon" />
    <!-- Font -->
    <!-- <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" /> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;400;700;900&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <!-- Icone -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- Style.css -->
    <link rel="stylesheet" href="./style/style-home.css" />
  </head>
  <body>
    <!-- ======= Header ======= -->
    <header
      id="header"
      class="header fixed-top d-flex align-items-center justify-content-between"
    >
      <div class="d-flex align-items-center justify-content-between w-50">
        <i class="bi bi-list toggle-sidebar-btn"></i>
        <a href="home.html" class="logo d-flex align-items-center">
          <i class="fa-solid fa-headphones fa-2xl me-3"></i>
          <span class="d-none d-lg-block">SNM</span>
        </a>
      </div>
      <div class="nav-item dropdown pe-3">
        <a
          class="nav-link nav-profile d-flex align-items-center pe-0"
          href="#"
          data-bs-toggle="dropdown"
        >
          <img
            src="./img/profile.png"
            alt="profile"
            style="width: 25px; height: 25px; border-radius: 50%"
          />
          <span
            class="d-none d-md-block dropdown-toggle ps-2"
            id="usernameHeader"
            >Username</span
          >
        </a>

        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
          <li class="dropdown-header" id="nominativoHeader">
            <h6>Nome Cognome</h6>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>

          <li>
            <a class="dropdown-item d-flex align-items-center" href="/profile">
              <i class="bi bi-person"></i>
              <span>Il mio profilo</span>
            </a>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li>
            <a class="dropdown-item d-flex align-items-center" href="/logout">
              <i class="bi bi-box-arrow-right"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </header>
    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
      <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
          <a class="nav-link collapsed" href="/home">
            <i class="bi bi-grid"></i>
            <span>Homepage</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/profile">
            <i class="bi bi-person"></i>
            <span>Profilo</span>
          </a>
        </li>
        <li class="nav-heading">Scopri</li>
        <li class="nav-item">
          <a class="nav-link" href="/tracks">
            <i class="bi bi-music-note"></i>
            <span>Brani</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/publicPlaylist">
            <i class="bi bi-music-note-list"></i>
            <span>Playlists</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link collapsed" href="/myPlaylist">
            <i class="bi bi-file-music"></i>
            <span>Le mie playlist</span>
          </a>
        </li>
      </ul>
    </aside>
    <!-- ======= Main ======= -->
    <div class="main" id="main">
      <!-- ======= Tracks offcanvas ======= -->
      <div
        class="offcanvas offcanvas-end p-3"
        tabindex="-1"
        id="offcanvasRight"
        aria-labelledby="offcanvasRightLabel"
      >
        <div class="offcanvas-header">
          <h1
            class="offcanvas-title text-truncate"
            id="offcanvasRightLabel"
          ></h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">...</div>
      </div>
      <!-- ======= Main search-bar ======= -->
      <div class="search-tracks">
        <div class="row">
          <div class="col-12">
            <h1 class="text-center mt-4">
              Cerca un brano e aggiungilo alle tue playlist!
            </h1>
            <h2 class="text-center text-secondary mb-3">
              Per cercare un brano, inserisci il nome del brano nella barra di
              ricerca
            </h2>
            <form
              class="search-form d-flex align-items-center w-100"
              method="GET"
              action=""
              id="search-form-trucks"
            >
              <input
                type="text"
                name="query"
                placeholder="Inserisci il nome di un brano"
                style="border-radius: 50px; height: 48px"
              />
              <button>
                <i class="bi bi-search"></i>
              </button>
            </form>
            <!-- ======= Filter ======= -->
            <div
              class="filtri mt-3 d-flex flex-column flex-md-row align-items-center align-items-md-start"
            >
              <button class="btn btn-link d-flex" onclick="toggleFilter()">
                <i class="bi bi-filter"></i>
                Filtri avanzati
              </button>
              <div
                class="search-filter d-flex w-75 d-none flex-column flex-md-row"
              >
                <!-- ======= Artist filter ======= -->
                <form
                  class="search-form d-flex align-items-center mx-md-3 mb-3 mb-md-0 w-75 mx-auto"
                  method="GET"
                  action=""
                  id="search-artist-track"
                >
                  <input
                    type="text"
                    name="query"
                    placeholder="Inserisci il cantante"
                    style="border-radius: 50px; height: 48px"
                  />
                  <button><i class="bi bi-search"></i></button>
                </form>
                <!-- ======= Genre filter ======= -->
                <form
                  class="search-form d-flex align-items-center w-75 mx-auto mx-md-0"
                  method="GET"
                  action=""
                  id="search-genre-track"
                >
                  <input
                    type="text"
                    name="query"
                    placeholder="Inserisci il genere"
                    style="border-radius: 50px; height: 48px"
                  />
                  <button>
                    <i class="bi bi-search"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ======= Playlists ======= -->
      <div class="tracks-card mt-5">
        <div class="d-flex justify-content-center">
          <div class="spinner-border" id="loader" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
        <div
          class="row row-cols-2 row-cols-sm-3 row-cols-xxl-6 row-cols-lg-5 row-cols-md-4"
        ></div>
      </div>
    </div>
    <script src="./main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/typed.js@2.0.16/dist/typed.umd.js"></script>
    <script>
      function toggleFilter() {
        const filter = document.querySelector('.search-filter');
        filter.classList.toggle('d-none');
      }

      let userPlaylists = [];
      fetch('/api/playlist/get-created-playlists')
        .then((response) => response.json())
        .then((data) => {
          if (data.status === 'ok') {
            userPlaylists.push(...data.data);
          }
        });

      const offcanvasBody = document.querySelector(
        '#offcanvasRight .offcanvas-body'
      );
      offcanvasBody.addEventListener('click', (e) => {
        if (e.target.classList.contains('dropup')) {
          const dropdown = e.target.nextElementSibling;
          dropdown.innerHTML = `
          <li>
             <a class="dropdown-header d-flex" href="/createPlaylist">
              <i class="fa-solid fa-plus fa-lg align-self-center"></i>
              <span class="mb-0 ms-2" style="font-size: 16px">Nuova playlist</span>
              </a>
           </li>
           <li>
             <hr class="dropdown-divider" />
            </li>`;
          userPlaylists.forEach((playlist) => {
            const playlistItem = document.createElement('li');
            playlistItem.innerHTML = `
            <li class="nav-item dropdown-item d-flex align-items-center">
              <i class="bi bi-music-note-list"></i>
              <a class="dropdown-item" href="#" data-id="${
                playlist._id
              }" data-trackid="${
              e.target.closest('.offcanvas-body').querySelector('.track-id')
                .textContent
            }">${playlist.titolo}</a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>
            `;
            dropdown.appendChild(playlistItem);
          });
        }
      });
      const addTrackToPlaylist = async (playlistId, trackId) => {
        const response = await fetch(
          `/api/playlist/add-track?playlistId=${playlistId}&trackId=${trackId}`,
          {
            method: 'POST',
          }
        );
        const data = await response.json();
      };
      offcanvasBody.addEventListener('click', async (e) => {
        event.preventDefault();
        if (e.target.classList.contains('dropdown-item')) {
          const playlistId = e.target.dataset.id;
          const trackId = e.target.dataset.trackid;
          addTrackToPlaylist(playlistId, trackId);
        }
      });

      const form1 = document.getElementById('search-form-trucks');
      form1.addEventListener('submit', (e) => {
        e.preventDefault();
      });

      const form2 = document.getElementById('search-artist-track');
      form2.addEventListener('submit', (e) => {
        e.preventDefault();
      });

      const form3 = document.getElementById('search-genre-track');
      form3.addEventListener('submit', (e) => {
        e.preventDefault();
      });

      const searchForm = document.getElementById('search-form-trucks');
      searchForm
        .querySelector('input[name="query"]')
        .addEventListener('input', async (e) => {
          const query = e.target.value;
          if (query.length < 1) {
            return;
          }
          const tracksContainer = document.querySelector('.tracks-card .row');
          tracksContainer.innerHTML = '';
          const loader = document.getElementById('loader');
          loader.classList.remove('d-none');
          const response = await fetch(
            `/api/spotify/search-tracks?query=${query}`
          );
          const data = await response.json();

          const tracks = data.data;
          tracks.sort((a, b) => {
            return b.popularity - a.popularity;
          });
          loader.classList.add('d-none');
          tracksContainer.innerHTML = '';
          tracks.forEach((track) => {
            const trackCard = document.createElement('div');
            trackCard.innerHTML = `
            <a class="t-card card mb-4 border-0" style="width: 150px;">
                <img
                src="${track.album.images[0].url}"
                class="card-img-top d-flex align-items-center">
                <h4 class="m-0 p-1 card-title text-truncate">${track.name}</h4>
                <h5 class="card-text px-1 text-truncate text-secondary">${track.artists[0].name}</h5>
                <p class="track-id d-none">${track.id}</p>
              </a>
          `;
            tracksContainer.appendChild(trackCard);
          });
          const trackCards = document.querySelectorAll('.t-card');
          trackCards.forEach((card) => {
            card.addEventListener('click', (e) => {
              const trackId =
                e.currentTarget.querySelector('.track-id').textContent;
              fetch('/api/spotify/get-track/' + trackId)
                .then((response) => response.json())
                .then((data) => {
                  if (data.status === 'ok') {
                    const track = data.data;
                    const offcanvasBody = document.querySelector(
                      '#offcanvasRight .offcanvas-body'
                    );
                    const duration = new Date(track.duration_ms);
                    const minutes = duration.getMinutes();
                    const seconds = duration.getSeconds();
                    const secondsString =
                      seconds < 10 ? '0' + seconds : seconds;
                    const minutesString =
                      minutes < 10 ? '0' + minutes : minutes;
                    const offcanvasTitle = document.querySelector(
                      '#offcanvasRight .offcanvas-title'
                    );
                    console.log(track);
                    const genres = track.genres
                      .slice(0, 3)
                      .sort(() => Math.random() - 0.5);
                    track.genres = genres;

                    offcanvasBody.innerHTML = `
                      <div class="row">
                        <div class="col-12">
                          <img
                            src="${track.album.images[0].url}"
                            class="img-fluid d-flex mx-auto justify-content-center"
                          />
                        </div>
                        <div class="col-12">
                          <h2 class="mt-4">${track.name}</h2>
                          <h3 class="text-secondary mt-2">${track.artists[0].name}</h3>
                          <div class="d-flex mt-2">
                            <i class="fa-solid fa-compact-disc me-1"></i>
                            <h5 class="m-0 p-0">${track.album.name}&nbsp;(${track.album.release_date})</h5>
                          </div>
                          <div class="d-flex mt-2">
                            <i class="fa-regular fa-clock d-inline me-1"></i>
                            <h5 class="m-0 p-0">${minutesString}:${secondsString}</h5>
                          </div>
                          <p class="d-none track-id">${track.id}</p>
                          <div class="dropup mt-3" id="playlistDrop">
                            <button
                              class="btn btn-custom w-100 mt-4 dropup"
                              type="button"
                              id="dropdownMenuButton"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              style="font-size: 14px"
                            >
                            Aggiungi
                            </button>
                            <ul class="dropdown-menu w-100 mb-3" aria-labelledby="dropdownMenuButton">
                            </ul>
                          </div>
                        </div>
                      </div>
                      `;
                    const offcanvasInstance = new bootstrap.Offcanvas(
                      document.querySelector('#offcanvasRight')
                    );
                    offcanvasInstance.show();
                  }
                });
            });
          });
        });

      const searchArtistForm = document.getElementById('search-artist-track');
      searchArtistForm
        .querySelector('input[name="query"]')
        .addEventListener('input', async (e) => {
          const query = e.target.value;
          if (query.length < 1) {
            return;
          }
          const tracksContainer = document.querySelector('.tracks-card .row');
          tracksContainer.innerHTML = '';
          const loader = document.getElementById('loader');
          loader.classList.remove('d-none');
          const response = await fetch(
            `/api/spotify/search-artist?artist=${query}`
          );
          const data = await response.json();
          console.log(data.data);

          const artistId = data.data[0].id;
          const response2 = await fetch(
            `/api/spotify/get-artist-tracks?artistId=${artistId}`
          );
          const data2 = await response2.json();
          const tracks = data2.data;
          tracks.sort((a, b) => {
            return b.popularity - a.popularity;
          });
          loader.classList.add('d-none');
          tracksContainer.innerHTML = '';
          tracks.forEach((track) => {
            console.log(track);
            const trackCard = document.createElement('div');
            trackCard.innerHTML = `
            <a class="t-card card mb-4 border-0" style="width: 150px;">
              <img
                src="${track.album.image}"
                class="card-img-top d-flex align-items-center">
                <h4 class="m-0 p-1 card-title text-truncate">${track.name}</h4>
                <h5 class="card-text px-1 text-truncate text-secondary">${track.artists[0].name}</h5>
                <p class="track-id d-none">${track.id}</p>
            </a>
          `;
            tracksContainer.appendChild(trackCard);
          });
          const trackCards = document.querySelectorAll('.t-card');
          trackCards.forEach((card) => {
            card.addEventListener('click', (e) => {
              const trackId =
                e.currentTarget.querySelector('.track-id').textContent;
              fetch('/api/spotify/get-track/' + trackId)
                .then((response) => response.json())
                .then((data) => {
                  if (data.status === 'ok') {
                    const track = data.data;
                    console.log(track);
                    const offcanvasBody = document.querySelector(
                      '#offcanvasRight .offcanvas-body'
                    );
                    const duration = new Date(track.duration_ms);
                    const minutes = duration.getMinutes();
                    const seconds = duration.getSeconds();
                    const secondsString =
                      seconds < 10 ? '0' + seconds : seconds;
                    const minutesString =
                      minutes < 10 ? '0' + minutes : minutes;
                    const offcanvasTitle = document.querySelector(
                      '#offcanvasRight .offcanvas-title'
                    );

                    const genres = track.genres
                      .slice(0, 3)
                      .sort(() => Math.random() - 0.5);
                    track.genres = genres;

                    offcanvasBody.innerHTML = `
                      <div class="row">
                        <div class="col-12">
                          <img
                            src="${track.album.images[0].url}"
                            class="img-fluid d-flex mx-auto justify-content-center"
                          />
                        </div>
                        <div class="col-12">
                          <h2 class="mt-4">${track.name}</h2>
                          <h3 class="text-secondary mt-2">${track.artists[0].name}</h3>
                          <div class="d-flex mt-2">
                            <i class="fa-solid fa-compact-disc me-1"></i>
                            <h5 class="m-0 p-0">${track.album.name}&nbsp;(${track.album.release_date})</h5>
                          </div>
                          <div class="d-flex mt-2">
                            <i class="fa-regular fa-clock d-inline me-1"></i>
                            <h5 class="m-0 p-0">${minutesString}:${secondsString}</h5>
                          </div>
                          <p class="d-none track-id">${track.id}</p>
                          <div class="dropup mt-3" id="playlistDrop">
                            <button
                              class="btn btn-custom w-100 mt-4 dropup"
                              type="button"
                              id="dropdownMenuButton"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              style="font-size: 14px"
                            >
                            Aggiungi
                            </button>
                            <ul class="dropdown-menu w-100 mb-3" aria-labelledby="dropdownMenuButton">
                            </ul>
                          </div>
                        </div>
                      </div>
                      `;
                    const offcanvasInstance = new bootstrap.Offcanvas(
                      document.querySelector('#offcanvasRight')
                    );
                    offcanvasInstance.show();
                  }
                });
            });
          });
        });

      const searchGenreForm = document.getElementById('search-genre-track');
      searchGenreForm
        .querySelector('input[name="query"]')
        .addEventListener('input', async (e) => {
          const query = e.target.value;
          if (query.length < 1) {
            return;
          }
          const tracksContainer = document.querySelector('.tracks-card .row');
          tracksContainer.innerHTML = '';
          const loader = document.getElementById('loader');
          loader.classList.remove('d-none');
          const response = await fetch(
            `/api/spotify/recommendations-genre?query=${query}`
          );
          const data = await response.json();
          const tracks = data.data.tracks;
          tracksContainer.innerHTML = '';
          tracks.sort((a, b) => b.popularity - a.popularity);
          if (tracks.length < 1) {
            loader.classList.add('d-none');
            const noTracks = document.createElement('div');
            noTracks.classList.add('col-12', 'w-100');
            noTracks.innerHTML = `
            <h3 class="text-center mt-5">Nessuna traccia trovata</h3>
            `;
            tracksContainer.appendChild(noTracks);
          }
          loader.classList.add('d-none');
          tracks.forEach((track) => {
            const trackCard = document.createElement('div');
            trackCard.innerHTML = `
            <a class="t-card card mb-4 border-0" style="width: 150px;">
                <img
                src="${track.album.images[0].url}"
                class="card-img-top d-flex align-items-center">
                <h4 class="m-0 p-1 card-title text-truncate">${track.name}</h4>
                <h5 class="card-text px-1 text-truncate text-secondary">${track.artists[0].name}</h5>
                <p class="track-id d-none">${track.id}</p>
              </a>
          `;
            tracksContainer.appendChild(trackCard);
          });
          const trackCards = document.querySelectorAll('.t-card');
          trackCards.forEach((card) => {
            card.addEventListener('click', (e) => {
              const trackId =
                e.currentTarget.querySelector('.track-id').textContent;
              fetch('/api/spotify/get-track/' + trackId)
                .then((response) => response.json())
                .then((data) => {
                  if (data.status === 'ok') {
                    const track = data.data;
                    const offcanvasBody = document.querySelector(
                      '#offcanvasRight .offcanvas-body'
                    );
                    const duration = new Date(track.duration_ms);
                    const minutes = duration.getMinutes();
                    const seconds = duration.getSeconds();
                    const secondsString =
                      seconds < 10 ? '0' + seconds : seconds;
                    const minutesString =
                      minutes < 10 ? '0' + minutes : minutes;
                    const offcanvasTitle = document.querySelector(
                      '#offcanvasRight .offcanvas-title'
                    );
                    const genres = track.genres
                      .slice(0, 3)
                      .sort(() => Math.random() - 0.5);
                    track.genres = genres;

                    offcanvasBody.innerHTML = `
                      <div class="row">
                        <div class="col-12">
                          <img
                            src="${track.album.images[0].url}"
                            class="img-fluid d-flex mx-auto justify-content-center"
                          />
                        </div>
                        <div class="col-12">
                          <h2 class="mt-4">${track.name}</h2>
                          <h3 class="text-secondary mt-2">${track.artists[0].name}</h3>
                          <div class="d-flex mt-2">
                            <i class="fa-solid fa-compact-disc me-1"></i>
                            <h5 class="m-0 p-0">${track.album.name}&nbsp;(${track.album.release_date})</h5>
                          </div>
                          <div class="d-flex mt-2">
                            <i class="fa-regular fa-clock d-inline me-1"></i>
                            <h5 class="m-0 p-0">${minutesString}:${secondsString}</h5>
                          </div>
                          <p class="d-none track-id">${track.id}</p>
                          <div class="dropup mt-3" id="playlistDrop">
                            <button
                              class="btn btn-custom w-100 mt-4 dropup"
                              type="button"
                              id="dropdownMenuButton"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              style="font-size: 14px"
                            >
                            Aggiungi
                            </button>
                            <ul class="dropdown-menu w-100 mb-3" aria-labelledby="dropdownMenuButton">
                            </ul>
                          </div>
                        </div>
                      </div>
                      `;
                    const offcanvasInstance = new bootstrap.Offcanvas(
                      document.querySelector('#offcanvasRight')
                    );
                    offcanvasInstance.show();
                  }
                });
            });
          });
        });

      const tracksContainer = document.querySelector('.tracks-card .row');
      fetch('/api/spotify/recommendations')
        .then((response) => response.json())
        .then((data) => {
          if (data.status === 'ok') {
            const tracks = data.data.tracks;
            tracks.sort((a, b) => {
              return b.popularity - a.popularity;
            });

            tracksContainer.classList.add();
            const loader = document.getElementById('loader');
            loader.classList.add('d-none');
            tracks.forEach((track) => {
              const trackCard = document.createElement('div');
              trackCard.innerHTML = `
              <a class="t-card card mb-4 border-0" style="width: 150px;">
                <img
                src="${track.album.images[0].url}"
                class="card-img-top d-flex align-items-center">
                <h4 class="m-0 p-1 card-title text-truncate">${track.name}</h4>
                <h5 class="card-text px-1 text-truncate text-secondary">${track.artists[0].name}</h5>
                <p class="track-id d-none">${track.id}</p>
              </a>
          `;
              tracksContainer.appendChild(trackCard);
            });
            const trackCards = document.querySelectorAll('.t-card');
            trackCards.forEach((card) => {
              card.addEventListener('click', (e) => {
                const trackId =
                  e.currentTarget.querySelector('.track-id').textContent;
                fetch('/api/spotify/get-track/' + trackId)
                  .then((response) => response.json())
                  .then((data) => {
                    if (data.status === 'ok') {
                      const track = data.data;
                      const offcanvasBody = document.querySelector(
                        '#offcanvasRight .offcanvas-body'
                      );
                      const offcanvasTitle = document.querySelector(
                        '#offcanvasRight .offcanvas-title'
                      );
                      const duration = new Date(track.duration_ms);
                      const minutes = duration.getMinutes();
                      const seconds = duration.getSeconds();
                      const secondsString =
                        seconds < 10 ? '0' + seconds : seconds;
                      const minutesString =
                        minutes < 10 ? '0' + minutes : minutes;
                      const genres = track.genres
                        .slice(0, 3)
                        .sort(() => Math.random() - 0.5);
                      track.genres = genres;

                      offcanvasBody.innerHTML = `
                      <div class="row">
                        <div class="col-12">
                          <img
                            src="${track.album.images[0].url}"
                            class="img-fluid d-flex mx-auto justify-content-center"
                          />
                        </div>
                        <div class="col-12">
                          <h2 class="mt-4">${track.name}</h2>
                          <h3 class="text-secondary mt-2">${track.artists[0].name}</h3>
                          <div class="d-flex mt-2">
                            <i class="fa-solid fa-compact-disc me-1"></i>
                            <h5 class="m-0 p-0">${track.album.name}&nbsp;(${track.album.release_date})</h5>
                          </div>
                          <div class="d-flex mt-2">
                            <i class="fa-regular fa-clock d-inline me-1"></i>
                            <h5 class="m-0 p-0">${minutesString}:${secondsString}</h5>
                          </div>
                          <p class="d-none track-id">${track.id}</p>
                          <div class="dropup mt-3" id="playlistDrop">
                            <button
                              class="btn btn-custom w-100 mt-4 dropup"
                              type="button"
                              id="dropdownMenuButton"
                              data-bs-toggle="dropdown"
                              aria-expanded="false"
                              style="font-size: 14px"
                            >
                            Aggiungi
                            </button>
                            <ul class="dropdown-menu w-100 mb-3" aria-labelledby="dropdownMenuButton">
                            </ul>
                          </div>
                        </div>
                      </div>
                      `;
                      const offcanvasInstance = new bootstrap.Offcanvas(
                        document.querySelector('#offcanvasRight')
                      );
                      offcanvasInstance.show();
                    }
                  });
              });
            });
          } else {
            const loader = document.getElementById('loader');
            loader.classList.add('d-none');
            const noTracks = document.createElement('div');
            noTracks.classList.add('col-12', 'w-100');
            noTracks.innerHTML = `
            <h3 class="text-center mt-5">Nessun brano consigliato disponibile</h3>
            `;
            tracksContainer.appendChild(noTracks);
          }
        });
    </script>
  </body>
</html>
